const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/lottie-DzwejvuX.js","assets/_commonjsHelpers-BosuxZz1.js"])))=>i.map(i=>d[i]);
import{f as L,s as K,h as Y,q as De,o as c,a as p,n as re,p as _,r as k,b as e,l as R,y as E,t as w,m as ie,c as A,i as Ee,d as M,E as T,w as H,T as X,v as V,x as U,F as G,k as F,j as ae,K as Oe,L as Te,g as He}from"./vue-DpDB_xhb.js";import{_ as Ve,a as S,u as ce}from"./index-DCUERR7g.js";import{_ as Ue}from"./ton_symbol-CfLG12-S.js";import{k as Re,j as je,l as ze,m as Ne}from"./client-Byqmzb3A.js";import"./index-D5GkNzM3.js";const Ze={Gunmetal:{center:5004643,edge:3095362},"Electric Indigo":{center:11108595,edge:5989080},"Ranger Green":{center:6256713,edge:3952443},Lemongrass:{center:11450458,edge:5608261},Lavender:{center:12028388,edge:9067196},"Hunter Green":{center:9416312,edge:4948571},"Khaki Green":{center:11382896,edge:7044436},Raspberry:{center:14711685,edge:11950464},Cyberpunk:{center:8753139,edge:8806355},"Pacific Green":{center:7325587,edge:3906692},"Sky Blue":{center:5813448,edge:5475266},"Roman Silver":{center:10725557,edge:8159370},"Pine Green":{center:7055740,edge:4094320},"Coral Red":{center:14322027,edge:12870991},"French Violet":{center:12738790,edge:9522905},"Electric Purple":{center:13267142,edge:9855700},"Pacific Cyan":{center:5947046,edge:4036026},"Pure Gold":{center:13413185,edge:9993010},Copper:{center:13665878,edge:10315057},Mustard:{center:13932557,edge:12875538},"Onyx Black":{center:5067348,edge:3225144},"English Violet":{center:11634363,edge:8870545},"Battleship Grey":{center:9211013,edge:7105638},"Light Olive":{center:12758884,edge:8945221},Cappuccino:{center:11636862,edge:8151894},Platinum:{center:11710119,edge:8946814},Rosewood:{center:12024439,edge:8473682},"Navy Blue":{center:7118557,edge:6057673},Tomato:{center:15104318,edge:13913663},"Steel Grey":{center:9937580,edge:6517372},"Midnight Blue":{center:6056325,edge:3489879},"Mint Green":{center:8309634,edge:4562522},Chocolate:{center:10776152,edge:7619643},Emerald:{center:7914885,edge:4366705},"Cobalt Blue":{center:6326479,edge:5333688},"Desert Sand":{center:11771778,edge:8287067},Persimmon:{center:15181658,edge:12937055},"Mexican Pink":{center:14902930,edge:13191548},Strawberry:{center:14519919,edge:12016224},Sapphire:{center:5809096,edge:5470658},Turquoise:{center:6209720,edge:4035214},"Carrot Juice":{center:14391399,edge:13070159},"French Blue":{center:6069188,edge:3634074},Fandango:{center:14846646,edge:10770571},Carmine:{center:14702410,edge:11024443},"Burnt Sienna":{center:14053180,edge:11881261},Feldgrau:{center:9015944,edge:6187875},"Jade Green":{center:5620892,edge:3905911},Moonstone:{center:8303028,edge:5800848},Pistachio:{center:9941116,edge:6062412},"Rifle Green":{center:6580572,edge:4936257},Amber:{center:14332741,edge:11632682},"Satin Gold":{center:12557127,edge:9271097},"Azure Blue":{center:6140363,edge:4492203},"Tactical Pine":{center:4489835,edge:3105641},"Fire Engine":{center:15753039,edge:12859721},"Indigo Dye":{center:5470609,edge:4285561},Grape:{center:10319041,edge:7949728},Black:{center:3553080,edge:921359},Burgundy:{center:10706534,edge:7160138},"Shamrock Green":{center:9089379,edge:5608261},"Mystic Pearl":{center:13667181,edge:11556720},"Dark Lilac":{center:11632037,edge:9197434},Chestnut:{center:12480340,edge:10045496},Malachite:{center:9811031,edge:4036437},Aquamarine:{center:6336917,edge:4631476},"Ivory White":{center:12236465,edge:10591639},"Old Gold":{center:11898168,edge:9726245},"Gunship Green":{center:5605989,edge:4023895},"Deep Cyan":{center:3257770,edge:1611161},"Seal Brown":{center:6704453,edge:4666926},"Camo Green":{center:7705677,edge:5534529},Orange:{center:13736506,edge:12611399},"Celtic Blue":{center:4569325,edge:3704537},Purple:{center:11431086,edge:8669060},"Neon Blue":{center:7706361,edge:6841060},"Dark Green":{center:5333825,edge:2835759},"Marine Blue":{center:5138588,edge:3885946},Caramel:{center:13670706,edge:12022833},"Silver Blue":{center:8430776,edge:6323345}};function ne(i){return"#"+(i&16777215).toString(16).padStart(6,"0")}function Ke(i){if(!i)return"linear-gradient(180deg, #3A3A3A 0%, #282727 100%)";const a=Ze[i];if(a)return`linear-gradient(180deg, ${ne(a.center)} 0%, ${ne(a.edge)} 100%)`;let t=0;for(let o=0;o<i.length;o++)t=(t<<5)-t+i.charCodeAt(o)|0;const u=Math.abs(t)%360;return`linear-gradient(180deg, hsl(${u}, 25%, 28%) 0%, hsl(${u}, 30%, 18%) 100%)`}const qe=["src","alt"],Je=L({__name:"LottieGift",props:{src:{},fallbackSrc:{},alt:{default:"Gift"},size:{default:100},autoplay:{type:Boolean,default:!0},loop:{type:Boolean,default:!0}},setup(i){let a=null;const t=async()=>(a||(a=await Ve(()=>import("./lottie-DzwejvuX.js").then(b=>b.l),__vite__mapDeps([0,1]))),a.default),u=i,o=k(null),g=k(!1);let d=null;async function v(){if(!o.value||!u.src){g.value=!0;return}d&&(d.destroy(),d=null),g.value=!1;try{const b=await t();if(!o.value)return;d=b.loadAnimation({container:o.value,renderer:"svg",loop:u.loop,autoplay:u.autoplay,path:u.src}),d.addEventListener("data_failed",()=>{g.value=!0,d?.destroy(),d=null}),d.addEventListener("error",()=>{g.value=!0,d?.destroy(),d=null})}catch{g.value=!0}}return K(()=>u.src,()=>{v()}),Y(()=>{v()}),De(()=>{d&&(d.destroy(),d=null)}),(b,h)=>(c(),p("div",{ref_key:"container",ref:o,class:"lottie-gift",style:re({width:i.size+"px",height:i.size+"px"})},[g.value&&i.fallbackSrc?(c(),p("img",{key:0,src:i.fallbackSrc,alt:i.alt,class:"lottie-gift__fallback",loading:"lazy",draggable:"false"},null,8,qe)):_("",!0)],4))}}),Qe=S(Je,[["__scopeId","data-v-66204c08"]]),We={class:"gift-card__image"},Ye=["src","alt"],Xe={key:2,class:"gift-card__placeholder"},et={key:3,class:"gift-card__source"},tt={key:0,width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor"},lt={class:"gift-card__meta"},st={class:"gift-card__name"},it={class:"gift-card__serial"},at={class:"gift-card__actions"},nt=L({__name:"GiftCard",props:{gift:{},selectable:{type:Boolean},isSelected:{type:Boolean}},emits:["click","buy","select"],setup(i,{emit:a}){const t=i,u=a,{hapticImpact:o}=ce(),g=k(!1),d=A(()=>{if(t.gift.animation_url)return t.gift.animation_url;if(t.gift.lottie_url)return t.gift.lottie_url;const f=t.gift.image_url;return f&&f.includes("nft.fragment.com/gift/")?f.replace(/\.(webp|jpg|png|medium\.jpg|large\.jpg|small\.jpg)$/i,".lottie.json"):null}),v=A(()=>Math.round(Math.min(window.innerWidth/2-20,180))),b=A(()=>t.gift.tg_id?t.gift.tg_id:t.gift.index?t.gift.index:t.gift.id),h=A(()=>{const f=t.gift.lowest_price_ton||t.gift.min_price_ton||t.gift.price||0,y=Number(f);return y<=0?null:y.toFixed(2).replace(/\.?0+$/,"")}),x=A(()=>({"--card-bg":Ke(t.gift.backdrop)})),$=()=>{o("light"),t.selectable?u("select",t.gift):u("click",t.gift)},m=()=>{o("medium"),u("buy",t.gift)};return(f,y)=>(c(),p("div",{class:"gift-card",style:re(x.value),onClick:$},[e("div",We,[d.value?(c(),R(Qe,{key:0,src:d.value,"fallback-src":i.gift.image_url,alt:i.gift.name,size:v.value,class:"gift-card__lottie"},null,8,["src","fallback-src","alt","size"])):i.gift.image_url&&!g.value?(c(),p("img",{key:1,src:i.gift.image_url,alt:i.gift.name,loading:"lazy",draggable:"false",onError:y[0]||(y[0]=P=>g.value=!0)},null,40,Ye)):(c(),p("div",Xe,[...y[1]||(y[1]=[e("span",{class:"gift-card__placeholder-emoji"},"ðŸŽ",-1)])])),i.gift.lowest_price_market?(c(),p("div",et,[...y[2]||(y[2]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("path",{d:"M2 12h20"}),e("path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"})],-1)])])):_("",!0),i.selectable?(c(),p("div",{key:4,class:E(["gift-card__checkbox",{"gift-card__checkbox--selected":i.isSelected}])},[i.isSelected?(c(),p("svg",tt,[...y[3]||(y[3]=[e("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"},null,-1)])])):_("",!0)],2)):_("",!0)]),e("div",lt,[e("span",st,w(i.gift.name),1),e("span",it,"#"+w(b.value),1)]),e("div",at,[h.value?(c(),p("button",{key:0,class:"gift-card__price",onClick:ie(m,["stop"])},[y[4]||(y[4]=e("svg",{class:"gift-card__ton",width:"12",height:"12",viewBox:"0 0 16 16",fill:"none"},[e("path",{d:"M12.7238 1.00488H3.27565C1.53846 1.00488 0.437395 2.87874 1.31137 4.39358L7.14243 14.5002C7.52294 15.1601 8.47652 15.1601 8.85703 14.5002L14.6893 4.39358C15.5621 2.88116 14.461 1.00488 12.725 1.00488H12.7238ZM7.13769 11.4694L5.86778 9.01168L2.80363 3.53153C2.60149 3.18078 2.85116 2.7313 3.27446 2.7313H7.1365V11.4705L7.13769 11.4694ZM13.1935 3.53035L10.1305 9.01287L8.86059 11.4694V2.73011H12.7226C13.1459 2.73011 13.3956 3.17959 13.1935 3.53035Z",fill:"currentColor"})],-1)),e("span",null,w(h.value),1)])):_("",!0),e("button",{class:"gift-card__cart",onClick:ie(m,["stop"])},[...y[5]||(y[5]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"}),e("path",{d:"M3 6h18"}),e("path",{d:"M16 10a4 4 0 0 1-8 0"})],-1)])])])],4))}}),ot=S(nt,[["__scopeId","data-v-e165cffb"]]),rt={class:"skeleton-card"},ct=L({__name:"SkeletonCard",setup(i){return(a,t)=>(c(),p("div",rt,[...t[0]||(t[0]=[Ee('<div class="skeleton-card__image skeleton" data-v-ef5d93a6></div><div class="skeleton-card__body" data-v-ef5d93a6><div class="skeleton-card__title skeleton" data-v-ef5d93a6></div><div class="skeleton-card__serial skeleton" data-v-ef5d93a6></div><div class="skeleton-card__price skeleton" data-v-ef5d93a6></div></div>',2)])]))}}),dt=S(ct,[["__scopeId","data-v-ef5d93a6"]]),ut={key:0,class:"filter-modal-sheet"},gt={class:"filter-modal-header"},vt={class:"filter-modal-title"},pt={class:"filter-modal-search"},mt={class:"filter-modal-counter-row"},ht={class:"filter-modal-counter-text"},ft={class:"filter-modal-list"},bt=["onClick"],yt={key:0,class:"filter-modal-thumbnail"},kt=["src","alt"],_t={key:1,class:"filter-modal-thumbnail-fallback"},wt={class:"filter-modal-text-block"},Ct={class:"filter-modal-label"},$t={class:"filter-modal-count"},xt={key:0,class:"filter-modal-rarity"},Mt={key:0,class:"filter-modal-price"},Pt={key:0,width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Bt={class:"filter-modal-footer"},Lt=["disabled"],St=L({__name:"FilterListModal",props:{visible:{type:Boolean},title:{},options:{},selected:{},showThumbnails:{type:Boolean},showRarity:{type:Boolean}},emits:["update:visible","apply"],setup(i,{emit:a}){const t=i,u=a,o=k([]),g=k(""),d=A(()=>{const $=g.value.toLowerCase();return t.options.filter(m=>m.label.toLowerCase().includes($))});K(()=>t.visible,$=>{$&&(o.value=[...t.selected],g.value="")});const v=$=>{const m=o.value.indexOf($);m>-1?o.value.splice(m,1):o.value.push($)},b=()=>{o.value.length===d.value.length&&d.value.length>0?o.value=[]:o.value=d.value.map($=>$.value)},h=()=>{u("apply",o.value),x()},x=()=>{u("update:visible",!1)};return($,m)=>(c(),R(X,{to:"body"},[M(T,{name:"overlay-fade"},{default:H(()=>[i.visible?(c(),p("div",{key:0,class:"filter-modal-overlay",onClick:x})):_("",!0)]),_:1}),M(T,{name:"sheet-slide"},{default:H(()=>[i.visible?(c(),p("div",ut,[e("div",gt,[e("h2",vt,w(i.title),1),e("button",{class:"filter-modal-close-btn",onClick:x,"aria-label":"Close"},[...m[1]||(m[1]=[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])]),e("div",pt,[m[2]||(m[2]=e("svg",{class:"filter-modal-search-icon",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M7 12C9.76142 12 12 9.76142 12 7C12 4.23858 9.76142 2 7 2C4.23858 2 2 4.23858 2 7C2 9.76142 4.23858 12 7 12Z",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M14 14L10.5 10.5",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),V(e("input",{"onUpdate:modelValue":m[0]||(m[0]=f=>g.value=f),type:"text",class:"filter-modal-search-input",placeholder:"Enter a keyword to search",autocomplete:"off"},null,512),[[U,g.value]])]),e("div",mt,[e("span",ht,"Selected: "+w(o.value.length),1),e("button",{class:"filter-modal-toggle-btn",onClick:b},w(o.value.length===d.value.length&&d.value.length>0?"Clear All":"Select All"),1)]),e("div",ft,[(c(!0),p(G,null,F(d.value,f=>(c(),p("div",{key:f.value,class:"filter-modal-item",onClick:y=>v(f.value)},[i.showThumbnails&&f.imageUrl?(c(),p("div",yt,[e("img",{src:f.imageUrl,alt:f.label},null,8,kt)])):i.showThumbnails?(c(),p("div",_t)):_("",!0),e("div",wt,[e("div",Ct,[ae(w(f.label)+" ",1),e("span",$t,"("+w(f.count||0)+")",1),i.showRarity&&f.rarity?(c(),p("span",xt,"("+w(f.rarity)+")",1)):_("",!0)]),f.floorPrice!==void 0?(c(),p("div",Mt,[m[3]||(m[3]=e("img",{src:Ue,width:"10",height:"10",style:{display:"inline-block","vertical-align":"middle","margin-right":"2px"}},null,-1)),ae("~"+w(f.floorPrice.toFixed(2))+" floor ",1)])):_("",!0)]),e("div",{class:E(["filter-modal-checkbox",{"filter-modal-checkbox--checked":o.value.includes(f.value)}])},[o.value.includes(f.value)?(c(),p("svg",Pt,[...m[4]||(m[4]=[e("path",{d:"M13.3333 4L6 11.3333L2.66667 8",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])])):_("",!0)],2)],8,bt))),128))]),e("div",Bt,[e("button",{class:"filter-modal-btn filter-modal-btn--secondary",onClick:x},"Close"),e("button",{class:"filter-modal-btn filter-modal-btn--primary",disabled:o.value.length===t.selected.length&&o.value.every(f=>t.selected.includes(f)),onClick:h}," Apply Filters ",8,Lt)])])):_("",!0)]),_:1})]))}}),N=S(St,[["__scopeId","data-v-35f52243"]]),Gt={key:0,class:"modal-wrapper"},It={class:"sheet"},At={class:"body"},Ft={class:"inputs-grid"},Dt={class:"input-group"},Et={class:"input-wrapper"},Ot={class:"input-group"},Tt={class:"input-wrapper"},Ht=L({__name:"PriceRangeModal",props:{visible:{type:Boolean},minPrice:{},maxPrice:{}},emits:["update:visible","apply"],setup(i,{emit:a}){const t=i,u=a,o=k(null),g=k(null);K(()=>t.visible,b=>{b&&(o.value=t.minPrice,g.value=t.maxPrice)});const d=()=>{u("update:visible",!1)},v=()=>{u("apply",o.value,g.value),u("update:visible",!1)};return(b,h)=>(c(),R(X,{to:"body"},[M(T,{name:"modal"},{default:H(()=>[i.visible?(c(),p("div",Gt,[e("div",{class:"overlay",onClick:d}),e("div",It,[e("div",{class:"header"},[h[3]||(h[3]=e("h2",{class:"title"},"Price Range",-1)),e("button",{class:"close-btn",onClick:d,"aria-label":"Close"},[...h[2]||(h[2]=[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none"},[e("path",{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})],-1)])])]),e("div",At,[e("div",Ft,[e("div",Dt,[e("div",Et,[h[4]||(h[4]=e("svg",{class:"icon",width:"12",height:"12",viewBox:"0 0 16 16",fill:"none"},[e("path",{d:"M12.7238 1.00488H3.27565C1.53846 1.00488 0.437395 2.87874 1.31137 4.39358L7.14243 14.5002C7.52294 15.1601 8.47652 15.1601 8.85703 14.5002L14.6893 4.39358C15.5621 2.88116 14.461 1.00488 12.725 1.00488H12.7238ZM7.13769 11.4694L5.86778 9.01168L2.80363 3.53153C2.60149 3.18078 2.85116 2.7313 3.27446 2.7313H7.1365V11.4705L7.13769 11.4694ZM13.1935 3.53035L10.1305 9.01287L8.86059 11.4694V2.73011H12.7226C13.1459 2.73011 13.3956 3.17959 13.1935 3.53035Z",fill:"currentColor"})],-1)),V(e("input",{"onUpdate:modelValue":h[0]||(h[0]=x=>o.value=x),type:"number",class:"input",placeholder:"0.00",min:"0",step:"0.01"},null,512),[[U,o.value,void 0,{number:!0}]])]),h[5]||(h[5]=e("label",{class:"label"},"Min",-1))]),e("div",Ot,[e("div",Tt,[h[6]||(h[6]=e("svg",{class:"icon",width:"12",height:"12",viewBox:"0 0 16 16",fill:"none"},[e("path",{d:"M12.7238 1.00488H3.27565C1.53846 1.00488 0.437395 2.87874 1.31137 4.39358L7.14243 14.5002C7.52294 15.1601 8.47652 15.1601 8.85703 14.5002L14.6893 4.39358C15.5621 2.88116 14.461 1.00488 12.725 1.00488H12.7238ZM7.13769 11.4694L5.86778 9.01168L2.80363 3.53153C2.60149 3.18078 2.85116 2.7313 3.27446 2.7313H7.1365V11.4705L7.13769 11.4694ZM13.1935 3.53035L10.1305 9.01287L8.86059 11.4694V2.73011H12.7226C13.1459 2.73011 13.3956 3.17959 13.1935 3.53035Z",fill:"currentColor"})],-1)),V(e("input",{"onUpdate:modelValue":h[1]||(h[1]=x=>g.value=x),type:"number",class:"input",placeholder:"100 000.00",min:"0",step:"0.01"},null,512),[[U,g.value,void 0,{number:!0}]])]),h[7]||(h[7]=e("label",{class:"label"},"Max",-1))])])]),e("div",{class:"footer"},[e("button",{class:"btn btn-secondary",onClick:d},"Close"),e("button",{class:"btn btn-primary",onClick:v},"Apply Filters")])])])):_("",!0)]),_:1})]))}}),Vt=S(Ht,[["__scopeId","data-v-de2a3570"]]),Ut={key:0,class:"modal-wrapper"},Rt={class:"sheet"},jt={class:"body"},zt={class:"input-group"},Nt={class:"footer"},Zt=["disabled"],Kt=L({__name:"GiftIdModal",props:{visible:{type:Boolean},giftId:{}},emits:["update:visible","apply"],setup(i,{emit:a}){const t=i,u=a,o=k(null);K(()=>t.visible,v=>{v&&(o.value=t.giftId)});const g=()=>{u("update:visible",!1)},d=()=>{u("apply",o.value),u("update:visible",!1)};return(v,b)=>(c(),R(X,{to:"body"},[M(T,{name:"modal"},{default:H(()=>[i.visible?(c(),p("div",Ut,[e("div",{class:"overlay",onClick:g}),e("div",Rt,[e("div",{class:"header"},[b[2]||(b[2]=e("h2",{class:"title"},"Gift ID",-1)),e("button",{class:"close-btn",onClick:g,"aria-label":"Close"},[...b[1]||(b[1]=[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none"},[e("path",{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})],-1)])])]),e("div",jt,[e("div",zt,[V(e("input",{"onUpdate:modelValue":b[0]||(b[0]=h=>o.value=h),type:"number",class:"input",placeholder:"Enter Gift ID",min:"0"},null,512),[[U,o.value,void 0,{number:!0}]])])]),e("div",Nt,[e("button",{class:"btn btn-secondary",onClick:g},"Cancel"),e("button",{class:"btn btn-primary",disabled:!o.value,onClick:d},"Save",8,Zt)])])])):_("",!0)]),_:1})]))}}),qt=S(Kt,[["__scopeId","data-v-587b3216"]]),Jt={key:0,class:"sort-dropdown-container"},Qt={class:"sort-dropdown"},Wt=["onClick"],Yt={class:"item-label"},Xt={key:0,class:"item-icon"},el={key:1,class:"checkmark-icon",viewBox:"0 0 24 24",width:"16",height:"16"},tl=L({__name:"SortDropdown",props:{visible:{type:Boolean},options:{},current:{}},emits:["update:visible","select"],setup(i,{emit:a}){const t=a,u=()=>{t("update:visible",!1)},o=g=>{t("select",g),t("update:visible",!1)};return(g,d)=>(c(),p(G,null,[i.visible?(c(),p("div",{key:0,class:"sort-dropdown-overlay",onClick:u})):_("",!0),M(T,{name:"sort-dropdown-fade"},{default:H(()=>[i.visible?(c(),p("div",Jt,[e("div",Qt,[(c(!0),p(G,null,F(i.options,v=>(c(),p("div",{key:v.value,class:E(["sort-item",{active:i.current===v.value}]),onClick:b=>o(v.value)},[e("div",{class:E(["radio-circle",{active:i.current===v.value}])},null,2),e("span",Yt,w(v.label),1),v.icon?(c(),p("div",Xt,[e("span",null,w(v.icon),1)])):_("",!0),i.current===v.value?(c(),p("svg",el,[...d[0]||(d[0]=[e("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z",fill:"currentColor"},null,-1)])])):_("",!0)],10,Wt))),128))])])):_("",!0)]),_:1})],64))}}),ll=S(tl,[["__scopeId","data-v-24c20201"]]),sl={key:0,class:"filter-tags-container"},il={class:"tags-scroll"},al=["src","alt"],nl={class:"tag-label"},ol=["onClick","aria-label"],rl=L({__name:"ActiveFilterTags",props:{tags:{}},emits:["remove","clear-all"],setup(i,{emit:a}){const t=a,u=(g,d)=>{t("remove",g,d)},o=()=>{t("clear-all")};return(g,d)=>i.tags.length>0?(c(),p("div",sl,[e("div",il,[e("button",{class:"clear-all-btn",onClick:o}," Clear All "),(c(!0),p(G,null,F(i.tags,v=>(c(),p("div",{key:`${v.key}-${v.label}`,class:"filter-tag"},[v.imageUrl?(c(),p("img",{key:0,src:v.imageUrl,alt:v.label,class:"tag-thumbnail"},null,8,al)):_("",!0),e("span",nl,w(v.label),1),e("button",{class:"tag-remove-btn",onClick:b=>u(v.key,v.label),"aria-label":`Remove ${v.label} filter`},[...d[0]||(d[0]=[e("svg",{viewBox:"0 0 24 24",width:"14",height:"14",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])],8,ol)]))),128))])])):_("",!0)}}),cl=S(rl,[["__scopeId","data-v-4ca4b413"]]),J="market_prices_cache",Q=5*60*1e3;function oe(i){return i.length===0?0:Math.min(...i.map(a=>a.price))}function dl(i){if(i.length===0)return 0;const a=[...i].sort((u,o)=>u.price-o.price),t=Math.floor(a.length/2);return a.length%2!==0?a[t].price:(a[t-1].price+a[t].price)/2}function ul(i){return i.length===0?null:i.reduce((a,t)=>t.price<a.price?t:a)}class gl{cache={};constructor(){this.loadCache()}loadCache(){try{const a=localStorage.getItem(J);a&&(this.cache=JSON.parse(a),this.cleanExpiredCache())}catch(a){console.warn("Failed to load price cache:",a),this.cache={}}}persistCache(){try{localStorage.setItem(J,JSON.stringify(this.cache))}catch(a){console.warn("Failed to persist price cache:",a)}}cleanExpiredCache(){const a=Date.now();for(const[t,u]of Object.entries(this.cache))a-u.timestamp>Q&&delete this.cache[t]}clearCache(){this.cache={},localStorage.removeItem(J)}getCachedPrice(a){const t=this.cache[a];return t?Date.now()-t.timestamp>Q?(delete this.cache[a],0):oe(t.prices):0}setCachedPrice(a,t){this.cache[a]={prices:t,timestamp:Date.now()}}async fetchFromApi(a){try{const t=await fetch(`/api/v1/gifts/${a}`);if(!t.ok)return null;const u=await t.json();return u.min_price_ton&&parseFloat(u.min_price_ton)>0?{source:"api",price:parseFloat(u.min_price_ton),currency:"TON",updatedAt:new Date}:null}catch{return null}}async getAggregatedPrice(a){const t=this.cache[a];if(t&&Date.now()-t.timestamp<Q)return t.prices;const o=(await Promise.allSettled([this.fetchFromApi(a)])).filter(g=>g.status==="fulfilled").map(g=>g.value).filter(g=>g!==null&&g.price>0);return o.length>0&&this.setCachedPrice(a,o),o}async getAggregatedGifts(a){const t=new Map,u=10;for(let o=0;o<a.length;o+=u){const g=a.slice(o,o+u);await Promise.all(g.map(async d=>{const v=await this.getAggregatedPrice(d);v.length>0&&t.set(d,{giftId:d,name:"",model:"",prices:v,minPrice:oe(v),medianPrice:dl(v),bestDeal:ul(v)})}))}return t}}const W=new gl;function vl(){const i=k(!1),a=k(null),t=k(new Map);return Y(()=>{W.loadCache()}),{isLoading:i,error:a,aggregatedData:t,preloadPrices:async o=>{i.value=!0,a.value=null;try{t.value=await W.getAggregatedGifts(o),W.persistCache()}catch(g){a.value="Failed to load prices",console.error("Preload prices error:",g)}finally{i.value=!1}}}}const pl={class:"market-view"},ml={class:"tabs"},hl=["onClick"],fl={class:"search-row"},bl={class:"search-box"},yl={class:"filters"},kl=["onClick"],_l={class:"controls-row"},wl={class:"controls-row__left"},Cl={class:"cart-bar__counter"},$l=["disabled"],xl={class:"cart-bar__count"},Ml={class:"controls-row__right"},Pl={class:"grid-wrap"},Bl={key:0,class:"grid"},Ll={key:1,class:"grid"},Sl={key:2,class:"pagination"},Gl=["disabled"],Il={class:"pagination__info"},Al=["disabled"],Fl={key:3,class:"empty"},Dl={class:"cart-bar"},El=["disabled"],Z=50,Ol=L({__name:"MarketView",setup(i){const a=He(),{hapticImpact:t}=ce(),{preloadPrices:u,aggregatedData:o}=vl(),g=[{id:"all",label:"Gifts"},{id:"upgrades",label:"Upgrades"}],d=k("all"),v=k(!0),b=k([]),h=k(""),x=k("price asc"),$=k(!1),m=k(null),f=k(!1),y=k([]),P=k(1),O=k(50),l=Te({names:[],models:[],backdrops:[],patterns:[],symbols:[],rarities:[],minPrice:null,maxPrice:null,giftId:null}),q=k([]),ee=k([]),te=k([]),le=k([]),j=r=>r.map(s=>({value:s.value,label:s.value,count:s.count,floorPrice:s.floor_price||void 0,imageUrl:s.image_url||void 0})).sort((s,n)=>(n.count||0)-(s.count||0)),de=[{key:"collections",label:"Collections",filterGroup:"names"},{key:"model",label:"Model",filterGroup:"models"},{key:"backdrop",label:"Background",filterGroup:"backdrops"},{key:"symbol",label:"Symbol",filterGroup:"symbols"},{key:"price",label:"Price",filterGroup:"price"},{key:"giftId",label:"Gift ID",filterGroup:"giftId"}],ue=r=>{switch(r){case"collections":return l.names.length>0;case"model":return l.models.length>0;case"backdrop":return l.backdrops.length>0;case"symbol":return l.symbols.length>0;case"price":return l.minPrice!==null||l.maxPrice!==null;case"giftId":return l.giftId!==null;default:return!1}},ge=r=>{switch(r.key){case"collections":return l.names.length>0?`Collections (${l.names.length})`:"Collections";case"model":return l.models.length>0?`Model (${l.models.length})`:"Model";case"backdrop":return l.backdrops.length>0?`Background (${l.backdrops.length})`:"Background";case"symbol":return l.symbols.length>0?`Symbol (${l.symbols.length})`:"Symbol";case"price":if(l.minPrice!==null||l.maxPrice!==null){const s=l.minPrice??0,n=l.maxPrice??"...";return`${s} - ${n} TON`}return"Price";case"giftId":return l.giftId!==null?`#${l.giftId}`:"Gift ID";default:return r.label}},ve=A(()=>{const r=[];return l.names.forEach(s=>{const n=q.value.find(I=>I.value===s);r.push({key:"names",label:s,imageUrl:n?.imageUrl})}),l.models.forEach(s=>{r.push({key:"models",label:s})}),l.backdrops.forEach(s=>{r.push({key:"backdrops",label:s})}),l.symbols.forEach(s=>{r.push({key:"symbols",label:s})}),(l.minPrice!==null||l.maxPrice!==null)&&r.push({key:"price",label:`${l.minPrice??0} - ${l.maxPrice??"..."} TON`}),l.giftId!==null&&r.push({key:"giftId",label:`#${l.giftId}`}),r}),pe=(r,s)=>{switch(t("light"),r){case"names":l.names=l.names.filter(n=>n!==s);break;case"models":l.models=l.models.filter(n=>n!==s);break;case"backdrops":l.backdrops=l.backdrops.filter(n=>n!==s);break;case"symbols":l.symbols=l.symbols.filter(n=>n!==s);break;case"price":l.minPrice=null,l.maxPrice=null;break;case"giftId":l.giftId=null;break}B()},me=()=>{t("medium"),l.names=[],l.models=[],l.backdrops=[],l.patterns=[],l.symbols=[],l.rarities=[],l.minPrice=null,l.maxPrice=null,l.giftId=null,B()},he=r=>{t("light"),m.value=r},fe=r=>{l.names=r,B()},be=r=>{l.models=r,B()},ye=r=>{l.backdrops=r,B()},ke=r=>{l.symbols=r,B()},_e=(r,s)=>{l.minPrice=r,l.maxPrice=s,B()},we=r=>{l.giftId=r,B()},B=()=>{P.value=1,D()},Ce=[{value:"price asc",label:"Price: Low to High"},{value:"price desc",label:"Price: High to Low"},{value:"id asc",label:"Gift ID: Ascending"},{value:"id desc",label:"Gift ID: Descending"},{value:"rarity asc",label:"Model Rarity: Low to High"},{value:"rarity desc",label:"Model Rarity: High to Low"},{value:"listed_at desc",label:"Newest First"}],$e=r=>{t("light"),d.value=r,r==="upgrades"&&a.push("/upgrade")},xe=r=>{t("light"),x.value=r,D()},Me=()=>{P.value>1&&(P.value--,D())},Pe=()=>{P.value<O.value&&(P.value++,D())},D=async()=>{v.value=!0;try{const r=(P.value-1)*Z,s=h.value?.trim();let n;if(s)n=await Re(s,{limit:Z,collection_id:void 0});else{const C={is_on_sale:!0,sort_by:x.value,limit:Z,offset:r};l.names.length>0&&(C.gift_type=l.names.join(",")),l.models.length>0&&(C.model=l.models.join(",")),l.backdrops.length>0&&(C.backdrop=l.backdrops.join(",")),l.patterns.length>0&&(C.pattern=l.patterns.join(",")),l.symbols.length>0&&(C.symbol=l.symbols.join(",")),l.minPrice!==null&&(C.price_min=l.minPrice),l.maxPrice!==null&&(C.price_max=l.maxPrice),l.giftId!==null&&(C.search=`#${l.giftId}`),n=await je(C)}let I=n.items||n||[];n.total&&(O.value=Math.ceil(n.total/Z)),b.value=I;const se=I.map(C=>C.id||C.gift_id).filter(Boolean);se.length>0&&u(se).then(()=>{b.value=I.map(C=>{const Fe=String(C.id||C.gift_id||""),z=o.value.get(Fe);return z&&z.minPrice>0?{...C,lowest_price_ton:z.minPrice,lowest_price_market:z.bestDeal?.source||C.lowest_price_market}:C})})}catch(r){console.error("Fetch gifts error:",r),b.value=[]}finally{v.value=!1}},Be=async()=>{try{const r=await ze({is_on_sale:!0});q.value=j(r.gift_types||[]),ee.value=j(r.models||[]),te.value=j(r.backdrops||[]),le.value=j(r.symbols||[])}catch{}},Le=async()=>{try{await Ne()}catch{}},Se=r=>{t("light"),a.push(`/gift/${r.id}`)},Ge=r=>{t("medium")},Ie=r=>{t("light");const s=y.value.indexOf(r.id);s>-1?y.value.splice(s,1):y.value.push(r.id)},Ae=()=>{t("heavy")};return Y(()=>{D(),Le(),Be()}),(r,s)=>(c(),p("div",pl,[e("nav",ml,[(c(),p(G,null,F(g,n=>e("button",{key:n.id,class:E(["tabs__item",{active:d.value===n.id}]),onClick:I=>$e(n.id)},w(n.label),11,hl)),64))]),e("div",fl,[e("div",bl,[s[13]||(s[13]=e("svg",{class:"search-box__icon",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"11",cy:"11",r:"8"}),e("path",{d:"m21 21-4.35-4.35"})],-1)),V(e("input",{"onUpdate:modelValue":s[0]||(s[0]=n=>h.value=n),type:"text",placeholder:"Enter a keyword to search",class:"search-box__input",onKeyup:s[1]||(s[1]=Oe(n=>B(),["enter"]))},null,544),[[U,h.value]])]),e("button",{class:"icon-btn",onClick:s[2]||(s[2]=n=>D())},[...s[14]||(s[14]=[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"}),e("path",{d:"M21 3v5h-5"})],-1)])])]),e("div",yl,[(c(),p(G,null,F(de,n=>e("button",{key:n.key,class:E(["filter-btn",{active:ue(n.key)}]),onClick:I=>he(n.key)},[e("span",null,w(ge(n)),1),s[15]||(s[15]=e("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3"},[e("path",{d:"m6 9 6 6 6-6"})],-1))],10,kl)),64))]),e("div",_l,[e("div",wl,[e("div",Cl,[e("button",{class:"cart-bar__btn",disabled:y.value.length===0,onClick:s[3]||(s[3]=n=>y.value.pop())},[...s[16]||(s[16]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2.5"},[e("path",{d:"M5 12h14"})],-1)])],8,$l),e("span",xl,w(y.value.length),1),e("button",{class:"cart-bar__btn",onClick:s[4]||(s[4]=n=>f.value=!f.value)},[...s[17]||(s[17]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2.5"},[e("path",{d:"M12 5v14"}),e("path",{d:"M5 12h14"})],-1)])])])]),e("div",Ml,[e("button",{class:"icon-btn icon-btn--sm",onClick:s[5]||(s[5]=n=>$.value=!$.value)},[...s[18]||(s[18]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 6h18"}),e("path",{d:"M7 12h10"}),e("path",{d:"M10 18h4"})],-1)])])])]),M(cl,{tags:ve.value,onRemove:pe,onClearAll:me},null,8,["tags"]),e("div",Pl,[v.value?(c(),p("div",Bl,[(c(),p(G,null,F(8,n=>M(dt,{key:"sk-"+n})),64))])):(c(),p("div",Ll,[(c(!0),p(G,null,F(b.value,n=>(c(),R(ot,{key:n.id,gift:n,selectable:f.value,"is-selected":y.value.includes(n.id),onClick:Se,onBuy:Ge,onSelect:Ie},null,8,["gift","selectable","is-selected"]))),128))])),!v.value&&O.value>1?(c(),p("div",Sl,[e("button",{class:"pagination__btn",disabled:P.value<=1,onClick:Me},[...s[19]||(s[19]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"m15 18-6-6 6-6"})],-1)])],8,Gl),e("span",Il,w(P.value)+" / "+w(O.value),1),e("button",{class:"pagination__btn",disabled:P.value>=O.value,onClick:Pe},[...s[20]||(s[20]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"m9 18 6-6-6-6"})],-1)])],8,Al)])):_("",!0),!v.value&&b.value.length===0?(c(),p("div",Fl,[...s[21]||(s[21]=[e("p",{class:"empty__title"},"No gifts found",-1),e("p",{class:"empty__hint"},"Try adjusting your filters",-1)])])):_("",!0)]),e("div",Dl,[e("button",{class:"cart-bar__checkout",disabled:y.value.length===0,onClick:Ae},[s[22]||(s[22]=e("svg",{class:"cart-bar__ton",width:"14",height:"14",viewBox:"0 0 16 16",fill:"none"},[e("path",{d:"M12.7238 1.00488H3.27565C1.53846 1.00488 0.437395 2.87874 1.31137 4.39358L7.14243 14.5002C7.52294 15.1601 8.47652 15.1601 8.85703 14.5002L14.6893 4.39358C15.5621 2.88116 14.461 1.00488 12.725 1.00488H12.7238ZM7.13769 11.4694L5.86778 9.01168L2.80363 3.53153C2.60149 3.18078 2.85116 2.7313 3.27446 2.7313H7.1365V11.4705L7.13769 11.4694ZM13.1935 3.53035L10.1305 9.01287L8.86059 11.4694V2.73011H12.7226C13.1459 2.73011 13.3956 3.17959 13.1935 3.53035Z",fill:"currentColor"})],-1)),e("span",null,"Cart ("+w(y.value.length)+")",1)],8,El)]),M(ll,{visible:$.value,options:Ce,current:x.value,"onUpdate:visible":s[6]||(s[6]=n=>$.value=n),onSelect:xe},null,8,["visible","current"]),M(N,{visible:m.value==="collections",title:"Collections",options:q.value,selected:l.names,"show-thumbnails":!0,"onUpdate:visible":s[7]||(s[7]=n=>m.value=n?"collections":null),onApply:fe},null,8,["visible","options","selected"]),M(N,{visible:m.value==="model",title:"Model",options:ee.value,selected:l.models,"show-thumbnails":!0,"show-rarity":!0,"onUpdate:visible":s[8]||(s[8]=n=>m.value=n?"model":null),onApply:be},null,8,["visible","options","selected"]),M(N,{visible:m.value==="backdrop",title:"Background",options:te.value,selected:l.backdrops,"show-thumbnails":!1,"onUpdate:visible":s[9]||(s[9]=n=>m.value=n?"backdrop":null),onApply:ye},null,8,["visible","options","selected"]),M(N,{visible:m.value==="symbol",title:"Symbol",options:le.value,selected:l.symbols,"show-thumbnails":!0,"onUpdate:visible":s[10]||(s[10]=n=>m.value=n?"symbol":null),onApply:ke},null,8,["visible","options","selected"]),M(Vt,{visible:m.value==="price","min-price":l.minPrice,"max-price":l.maxPrice,"onUpdate:visible":s[11]||(s[11]=n=>m.value=n?"price":null),onApply:_e},null,8,["visible","min-price","max-price"]),M(qt,{visible:m.value==="giftId","gift-id":l.giftId,"onUpdate:visible":s[12]||(s[12]=n=>m.value=n?"giftId":null),onApply:we},null,8,["visible","gift-id"])]))}}),jl=S(Ol,[["__scopeId","data-v-ad4e3705"]]);export{jl as default};
