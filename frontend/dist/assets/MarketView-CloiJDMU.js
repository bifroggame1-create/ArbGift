const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/lottie-DzwejvuX.js","assets/_commonjsHelpers-BosuxZz1.js"])))=>i.map(i=>d[i]);
import{f as I,y as K,h as W,q as De,o as c,a as g,n as ne,p as C,r as w,b as e,l as N,x as T,t as P,m as te,c as B,i as Ee,d as M,E as U,w as H,T as Y,s as V,v as R,F,k as D,j as Te,K as Oe,L as Ue,g as He}from"./vue-DjRH996n.js";import{_ as Ve,a as A,u as re}from"./index-Der5g7Ax.js";import{k as Re,j as le,l as Ne}from"./client-BllIIJUg.js";import"./index-D5GkNzM3.js";const ze={Gunmetal:{center:5004643,edge:3095362},"Electric Indigo":{center:11108595,edge:5989080},"Ranger Green":{center:6256713,edge:3952443},Lemongrass:{center:11450458,edge:5608261},Lavender:{center:12028388,edge:9067196},"Hunter Green":{center:9416312,edge:4948571},"Khaki Green":{center:11382896,edge:7044436},Raspberry:{center:14711685,edge:11950464},Cyberpunk:{center:8753139,edge:8806355},"Pacific Green":{center:7325587,edge:3906692},"Sky Blue":{center:5813448,edge:5475266},"Roman Silver":{center:10725557,edge:8159370},"Pine Green":{center:7055740,edge:4094320},"Coral Red":{center:14322027,edge:12870991},"French Violet":{center:12738790,edge:9522905},"Electric Purple":{center:13267142,edge:9855700},"Pacific Cyan":{center:5947046,edge:4036026},"Pure Gold":{center:13413185,edge:9993010},Copper:{center:13665878,edge:10315057},Mustard:{center:13932557,edge:12875538},"Onyx Black":{center:5067348,edge:3225144},"English Violet":{center:11634363,edge:8870545},"Battleship Grey":{center:9211013,edge:7105638},"Light Olive":{center:12758884,edge:8945221},Cappuccino:{center:11636862,edge:8151894},Platinum:{center:11710119,edge:8946814},Rosewood:{center:12024439,edge:8473682},"Navy Blue":{center:7118557,edge:6057673},Tomato:{center:15104318,edge:13913663},"Steel Grey":{center:9937580,edge:6517372},"Midnight Blue":{center:6056325,edge:3489879},"Mint Green":{center:8309634,edge:4562522},Chocolate:{center:10776152,edge:7619643},Emerald:{center:7914885,edge:4366705},"Cobalt Blue":{center:6326479,edge:5333688},"Desert Sand":{center:11771778,edge:8287067},Persimmon:{center:15181658,edge:12937055},"Mexican Pink":{center:14902930,edge:13191548},Strawberry:{center:14519919,edge:12016224},Sapphire:{center:5809096,edge:5470658},Turquoise:{center:6209720,edge:4035214},"Carrot Juice":{center:14391399,edge:13070159},"French Blue":{center:6069188,edge:3634074},Fandango:{center:14846646,edge:10770571},Carmine:{center:14702410,edge:11024443},"Burnt Sienna":{center:14053180,edge:11881261},Feldgrau:{center:9015944,edge:6187875},"Jade Green":{center:5620892,edge:3905911},Moonstone:{center:8303028,edge:5800848},Pistachio:{center:9941116,edge:6062412},"Rifle Green":{center:6580572,edge:4936257},Amber:{center:14332741,edge:11632682},"Satin Gold":{center:12557127,edge:9271097},"Azure Blue":{center:6140363,edge:4492203},"Tactical Pine":{center:4489835,edge:3105641},"Fire Engine":{center:15753039,edge:12859721},"Indigo Dye":{center:5470609,edge:4285561},Grape:{center:10319041,edge:7949728},Black:{center:3553080,edge:921359},Burgundy:{center:10706534,edge:7160138},"Shamrock Green":{center:9089379,edge:5608261},"Mystic Pearl":{center:13667181,edge:11556720},"Dark Lilac":{center:11632037,edge:9197434},Chestnut:{center:12480340,edge:10045496},Malachite:{center:9811031,edge:4036437},Aquamarine:{center:6336917,edge:4631476},"Ivory White":{center:12236465,edge:10591639},"Old Gold":{center:11898168,edge:9726245},"Gunship Green":{center:5605989,edge:4023895},"Deep Cyan":{center:3257770,edge:1611161},"Seal Brown":{center:6704453,edge:4666926},"Camo Green":{center:7705677,edge:5534529},Orange:{center:13736506,edge:12611399},"Celtic Blue":{center:4569325,edge:3704537},Purple:{center:11431086,edge:8669060},"Neon Blue":{center:7706361,edge:6841060},"Dark Green":{center:5333825,edge:2835759},"Marine Blue":{center:5138588,edge:3885946},Caramel:{center:13670706,edge:12022833},"Silver Blue":{center:8430776,edge:6323345}};function ie(n){return"#"+(n&16777215).toString(16).padStart(6,"0")}function je(n){if(!n)return"linear-gradient(180deg, #3A3A3A 0%, #282727 100%)";const o=ze[n];if(o)return`linear-gradient(180deg, ${ie(o.center)} 0%, ${ie(o.edge)} 100%)`;let s=0;for(let a=0;a<n.length;a++)s=(s<<5)-s+n.charCodeAt(a)|0;const u=Math.abs(s)%360;return`linear-gradient(180deg, hsl(${u}, 25%, 28%) 0%, hsl(${u}, 30%, 18%) 100%)`}const Ze=["src","alt"],Ke=I({__name:"LottieGift",props:{src:{},fallbackSrc:{},alt:{default:"Gift"},size:{default:100},autoplay:{type:Boolean,default:!0},loop:{type:Boolean,default:!0}},setup(n){let o=null;const s=async()=>(o||(o=await Ve(()=>import("./lottie-DzwejvuX.js").then(k=>k.l),__vite__mapDeps([0,1]))),o.default),u=n,a=w(null),m=w(!1);let d=null;async function v(){if(!a.value||!u.src){m.value=!0;return}d&&(d.destroy(),d=null),m.value=!1;try{const k=await s();if(!a.value)return;d=k.loadAnimation({container:a.value,renderer:"svg",loop:u.loop,autoplay:u.autoplay,path:u.src}),d.addEventListener("data_failed",()=>{m.value=!0,d?.destroy(),d=null}),d.addEventListener("error",()=>{m.value=!0,d?.destroy(),d=null})}catch{m.value=!0}}return K(()=>u.src,()=>{v()}),W(()=>{v()}),De(()=>{d&&(d.destroy(),d=null)}),(k,h)=>(c(),g("div",{ref_key:"container",ref:a,class:"lottie-gift",style:ne({width:n.size+"px",height:n.size+"px"})},[m.value&&n.fallbackSrc?(c(),g("img",{key:0,src:n.fallbackSrc,alt:n.alt,class:"lottie-gift__fallback",loading:"lazy",draggable:"false"},null,8,Ze)):C("",!0)],4))}}),qe=A(Ke,[["__scopeId","data-v-66204c08"]]),Je={class:"gift-card__image"},Qe=["src","alt"],We={key:2,class:"gift-card__placeholder"},Ye={key:3,class:"gift-card__source"},Xe={key:0,width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor"},et={class:"gift-card__meta"},tt={class:"gift-card__name"},lt={class:"gift-card__serial"},it={class:"gift-card__actions"},st=I({__name:"GiftCard",props:{gift:{},selectable:{type:Boolean},isSelected:{type:Boolean}},emits:["click","buy","select"],setup(n,{emit:o}){const s=n,u=o,{hapticImpact:a}=re(),m=w(!1),d=B(()=>{if(s.gift.animation_url)return s.gift.animation_url;if(s.gift.lottie_url)return s.gift.lottie_url;const b=s.gift.image_url;return b&&b.includes("nft.fragment.com/gift/")?b.replace(/\.(webp|jpg|png|medium\.jpg|large\.jpg|small\.jpg)$/i,".lottie.json"):null}),v=B(()=>Math.round(Math.min(window.innerWidth/2-20,180))),k=B(()=>s.gift.tg_id?s.gift.tg_id:s.gift.index?s.gift.index:s.gift.id),h=B(()=>{const b=s.gift.lowest_price_ton||s.gift.min_price_ton||s.gift.price||0,_=Number(b);return _<=0?null:_.toFixed(2).replace(/\.?0+$/,"")}),$=B(()=>({"--card-bg":je(s.gift.backdrop)})),x=()=>{a("light"),s.selectable?u("select",s.gift):u("click",s.gift)},f=()=>{a("medium"),u("buy",s.gift)};return(b,_)=>(c(),g("div",{class:"gift-card",style:ne($.value),onClick:x},[e("div",Je,[d.value?(c(),N(qe,{key:0,src:d.value,"fallback-src":n.gift.image_url,alt:n.gift.name,size:v.value,class:"gift-card__lottie"},null,8,["src","fallback-src","alt","size"])):n.gift.image_url&&!m.value?(c(),g("img",{key:1,src:n.gift.image_url,alt:n.gift.name,loading:"lazy",draggable:"false",onError:_[0]||(_[0]=L=>m.value=!0)},null,40,Qe)):(c(),g("div",We,[..._[1]||(_[1]=[e("span",{class:"gift-card__placeholder-emoji"},"ðŸŽ",-1)])])),n.gift.lowest_price_market?(c(),g("div",Ye,[..._[2]||(_[2]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("path",{d:"M2 12h20"}),e("path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"})],-1)])])):C("",!0),n.selectable?(c(),g("div",{key:4,class:T(["gift-card__checkbox",{"gift-card__checkbox--selected":n.isSelected}])},[n.isSelected?(c(),g("svg",Xe,[..._[3]||(_[3]=[e("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"},null,-1)])])):C("",!0)],2)):C("",!0)]),e("div",et,[e("span",tt,P(n.gift.name),1),e("span",lt,"#"+P(k.value),1)]),e("div",it,[h.value?(c(),g("button",{key:0,class:"gift-card__price",onClick:te(f,["stop"])},[_[4]||(_[4]=e("svg",{class:"gift-card__ton",width:"12",height:"12",viewBox:"0 0 16 16",fill:"none"},[e("path",{d:"M12.7238 1.00488H3.27565C1.53846 1.00488 0.437395 2.87874 1.31137 4.39358L7.14243 14.5002C7.52294 15.1601 8.47652 15.1601 8.85703 14.5002L14.6893 4.39358C15.5621 2.88116 14.461 1.00488 12.725 1.00488H12.7238ZM7.13769 11.4694L5.86778 9.01168L2.80363 3.53153C2.60149 3.18078 2.85116 2.7313 3.27446 2.7313H7.1365V11.4705L7.13769 11.4694ZM13.1935 3.53035L10.1305 9.01287L8.86059 11.4694V2.73011H12.7226C13.1459 2.73011 13.3956 3.17959 13.1935 3.53035Z",fill:"currentColor"})],-1)),e("span",null,P(h.value),1)])):C("",!0),e("button",{class:"gift-card__cart",onClick:te(f,["stop"])},[..._[5]||(_[5]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"}),e("path",{d:"M3 6h18"}),e("path",{d:"M16 10a4 4 0 0 1-8 0"})],-1)])])])],4))}}),nt=A(st,[["__scopeId","data-v-e165cffb"]]),rt={class:"skeleton-card"},ot=I({__name:"SkeletonCard",setup(n){return(o,s)=>(c(),g("div",rt,[...s[0]||(s[0]=[Ee('<div class="skeleton-card__image skeleton" data-v-ef5d93a6></div><div class="skeleton-card__body" data-v-ef5d93a6><div class="skeleton-card__title skeleton" data-v-ef5d93a6></div><div class="skeleton-card__serial skeleton" data-v-ef5d93a6></div><div class="skeleton-card__price skeleton" data-v-ef5d93a6></div></div>',2)])]))}}),at=A(ot,[["__scopeId","data-v-ef5d93a6"]]),ct={key:0,class:"filter-modal-sheet"},dt={class:"filter-modal-header"},ut={class:"filter-modal-title"},mt={class:"filter-modal-search"},vt={class:"filter-modal-counter-row"},gt={class:"filter-modal-counter-text"},pt={class:"filter-modal-list"},ft=["onClick"],ht={key:0,class:"filter-modal-thumbnail"},bt=["src","alt"],yt={key:1,class:"filter-modal-thumbnail-fallback"},kt={class:"filter-modal-text-block"},_t={class:"filter-modal-label"},wt={class:"filter-modal-count"},Ct={key:0,class:"filter-modal-rarity"},Pt={key:0,class:"filter-modal-price"},xt={key:0,width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},$t={class:"filter-modal-footer"},Mt=["disabled"],Bt=I({__name:"FilterListModal",props:{visible:{type:Boolean},title:{},options:{},selected:{},showThumbnails:{type:Boolean},showRarity:{type:Boolean}},emits:["update:visible","apply"],setup(n,{emit:o}){const s=n,u=o,a=w([]),m=w(""),d=B(()=>{const x=m.value.toLowerCase();return s.options.filter(f=>f.label.toLowerCase().includes(x))});K(()=>s.visible,x=>{x&&(a.value=[...s.selected],m.value="")});const v=x=>{const f=a.value.indexOf(x);f>-1?a.value.splice(f,1):a.value.push(x)},k=()=>{a.value.length===d.value.length&&d.value.length>0?a.value=[]:a.value=d.value.map(x=>x.value)},h=()=>{u("apply",a.value),$()},$=()=>{u("update:visible",!1)};return(x,f)=>(c(),N(Y,{to:"body"},[M(U,{name:"overlay-fade"},{default:H(()=>[n.visible?(c(),g("div",{key:0,class:"filter-modal-overlay",onClick:$})):C("",!0)]),_:1}),M(U,{name:"sheet-slide"},{default:H(()=>[n.visible?(c(),g("div",ct,[e("div",dt,[e("h2",ut,P(n.title),1),e("button",{class:"filter-modal-close-btn",onClick:$,"aria-label":"Close"},[...f[1]||(f[1]=[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])]),e("div",mt,[f[2]||(f[2]=e("svg",{class:"filter-modal-search-icon",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M7 12C9.76142 12 12 9.76142 12 7C12 4.23858 9.76142 2 7 2C4.23858 2 2 4.23858 2 7C2 9.76142 4.23858 12 7 12Z",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M14 14L10.5 10.5",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),V(e("input",{"onUpdate:modelValue":f[0]||(f[0]=b=>m.value=b),type:"text",class:"filter-modal-search-input",placeholder:"Enter a keyword to search",autocomplete:"off"},null,512),[[R,m.value]])]),e("div",vt,[e("span",gt,"Selected: "+P(a.value.length),1),e("button",{class:"filter-modal-toggle-btn",onClick:k},P(a.value.length===d.value.length&&d.value.length>0?"Clear All":"Select All"),1)]),e("div",pt,[(c(!0),g(F,null,D(d.value,b=>(c(),g("div",{key:b.value,class:"filter-modal-item",onClick:_=>v(b.value)},[n.showThumbnails&&b.imageUrl?(c(),g("div",ht,[e("img",{src:b.imageUrl,alt:b.label},null,8,bt)])):n.showThumbnails?(c(),g("div",yt)):C("",!0),e("div",kt,[e("div",_t,[Te(P(b.label)+" ",1),e("span",wt,"("+P(b.count||0)+")",1),n.showRarity&&b.rarity?(c(),g("span",Ct,"("+P(b.rarity)+")",1)):C("",!0)]),b.floorPrice!==void 0?(c(),g("div",Pt," ~"+P(b.floorPrice.toFixed(2))+" TON floor ",1)):C("",!0)]),e("div",{class:T(["filter-modal-checkbox",{"filter-modal-checkbox--checked":a.value.includes(b.value)}])},[a.value.includes(b.value)?(c(),g("svg",xt,[...f[3]||(f[3]=[e("path",{d:"M13.3333 4L6 11.3333L2.66667 8",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])])):C("",!0)],2)],8,ft))),128))]),e("div",$t,[e("button",{class:"filter-modal-btn filter-modal-btn--secondary",onClick:$},"Close"),e("button",{class:"filter-modal-btn filter-modal-btn--primary",disabled:a.value.length===s.selected.length&&a.value.every(b=>s.selected.includes(b)),onClick:h}," Apply Filters ",8,Mt)])])):C("",!0)]),_:1})]))}}),j=A(Bt,[["__scopeId","data-v-0c072504"]]),Lt={key:0,class:"modal-wrapper"},St={class:"sheet"},Gt={class:"body"},It={class:"inputs-grid"},At={class:"input-group"},Ft={class:"input-wrapper"},Dt={class:"input-group"},Et={class:"input-wrapper"},Tt=I({__name:"PriceRangeModal",props:{visible:{type:Boolean},minPrice:{},maxPrice:{}},emits:["update:visible","apply"],setup(n,{emit:o}){const s=n,u=o,a=w(null),m=w(null);K(()=>s.visible,k=>{k&&(a.value=s.minPrice,m.value=s.maxPrice)});const d=()=>{u("update:visible",!1)},v=()=>{u("apply",a.value,m.value),u("update:visible",!1)};return(k,h)=>(c(),N(Y,{to:"body"},[M(U,{name:"modal"},{default:H(()=>[n.visible?(c(),g("div",Lt,[e("div",{class:"overlay",onClick:d}),e("div",St,[e("div",{class:"header"},[h[3]||(h[3]=e("h2",{class:"title"},"Price Range",-1)),e("button",{class:"close-btn",onClick:d,"aria-label":"Close"},[...h[2]||(h[2]=[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none"},[e("path",{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})],-1)])])]),e("div",Gt,[e("div",It,[e("div",At,[e("div",Ft,[h[4]||(h[4]=e("svg",{class:"icon",width:"12",height:"12",viewBox:"0 0 16 16",fill:"none"},[e("path",{d:"M12.7238 1.00488H3.27565C1.53846 1.00488 0.437395 2.87874 1.31137 4.39358L7.14243 14.5002C7.52294 15.1601 8.47652 15.1601 8.85703 14.5002L14.6893 4.39358C15.5621 2.88116 14.461 1.00488 12.725 1.00488H12.7238ZM7.13769 11.4694L5.86778 9.01168L2.80363 3.53153C2.60149 3.18078 2.85116 2.7313 3.27446 2.7313H7.1365V11.4705L7.13769 11.4694ZM13.1935 3.53035L10.1305 9.01287L8.86059 11.4694V2.73011H12.7226C13.1459 2.73011 13.3956 3.17959 13.1935 3.53035Z",fill:"currentColor"})],-1)),V(e("input",{"onUpdate:modelValue":h[0]||(h[0]=$=>a.value=$),type:"number",class:"input",placeholder:"0.00",min:"0",step:"0.01"},null,512),[[R,a.value,void 0,{number:!0}]])]),h[5]||(h[5]=e("label",{class:"label"},"Min",-1))]),e("div",Dt,[e("div",Et,[h[6]||(h[6]=e("svg",{class:"icon",width:"12",height:"12",viewBox:"0 0 16 16",fill:"none"},[e("path",{d:"M12.7238 1.00488H3.27565C1.53846 1.00488 0.437395 2.87874 1.31137 4.39358L7.14243 14.5002C7.52294 15.1601 8.47652 15.1601 8.85703 14.5002L14.6893 4.39358C15.5621 2.88116 14.461 1.00488 12.725 1.00488H12.7238ZM7.13769 11.4694L5.86778 9.01168L2.80363 3.53153C2.60149 3.18078 2.85116 2.7313 3.27446 2.7313H7.1365V11.4705L7.13769 11.4694ZM13.1935 3.53035L10.1305 9.01287L8.86059 11.4694V2.73011H12.7226C13.1459 2.73011 13.3956 3.17959 13.1935 3.53035Z",fill:"currentColor"})],-1)),V(e("input",{"onUpdate:modelValue":h[1]||(h[1]=$=>m.value=$),type:"number",class:"input",placeholder:"100 000.00",min:"0",step:"0.01"},null,512),[[R,m.value,void 0,{number:!0}]])]),h[7]||(h[7]=e("label",{class:"label"},"Max",-1))])])]),e("div",{class:"footer"},[e("button",{class:"btn btn-secondary",onClick:d},"Close"),e("button",{class:"btn btn-primary",onClick:v},"Apply Filters")])])])):C("",!0)]),_:1})]))}}),Ot=A(Tt,[["__scopeId","data-v-de2a3570"]]),Ut={key:0,class:"modal-wrapper"},Ht={class:"sheet"},Vt={class:"body"},Rt={class:"input-group"},Nt={class:"footer"},zt=["disabled"],jt=I({__name:"GiftIdModal",props:{visible:{type:Boolean},giftId:{}},emits:["update:visible","apply"],setup(n,{emit:o}){const s=n,u=o,a=w(null);K(()=>s.visible,v=>{v&&(a.value=s.giftId)});const m=()=>{u("update:visible",!1)},d=()=>{u("apply",a.value),u("update:visible",!1)};return(v,k)=>(c(),N(Y,{to:"body"},[M(U,{name:"modal"},{default:H(()=>[n.visible?(c(),g("div",Ut,[e("div",{class:"overlay",onClick:m}),e("div",Ht,[e("div",{class:"header"},[k[2]||(k[2]=e("h2",{class:"title"},"Gift ID",-1)),e("button",{class:"close-btn",onClick:m,"aria-label":"Close"},[...k[1]||(k[1]=[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none"},[e("path",{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})],-1)])])]),e("div",Vt,[e("div",Rt,[V(e("input",{"onUpdate:modelValue":k[0]||(k[0]=h=>a.value=h),type:"number",class:"input",placeholder:"Enter Gift ID",min:"0"},null,512),[[R,a.value,void 0,{number:!0}]])])]),e("div",Nt,[e("button",{class:"btn btn-secondary",onClick:m},"Cancel"),e("button",{class:"btn btn-primary",disabled:!a.value,onClick:d},"Save",8,zt)])])])):C("",!0)]),_:1})]))}}),Zt=A(jt,[["__scopeId","data-v-587b3216"]]),Kt={key:0,class:"sort-dropdown-container"},qt={class:"sort-dropdown"},Jt=["onClick"],Qt={class:"item-label"},Wt={key:0,class:"item-icon"},Yt={key:1,class:"checkmark-icon",viewBox:"0 0 24 24",width:"16",height:"16"},Xt=I({__name:"SortDropdown",props:{visible:{type:Boolean},options:{},current:{}},emits:["update:visible","select"],setup(n,{emit:o}){const s=o,u=()=>{s("update:visible",!1)},a=m=>{s("select",m),s("update:visible",!1)};return(m,d)=>(c(),g(F,null,[n.visible?(c(),g("div",{key:0,class:"sort-dropdown-overlay",onClick:u})):C("",!0),M(U,{name:"sort-dropdown-fade"},{default:H(()=>[n.visible?(c(),g("div",Kt,[e("div",qt,[(c(!0),g(F,null,D(n.options,v=>(c(),g("div",{key:v.value,class:T(["sort-item",{active:n.current===v.value}]),onClick:k=>a(v.value)},[e("div",{class:T(["radio-circle",{active:n.current===v.value}])},null,2),e("span",Qt,P(v.label),1),v.icon?(c(),g("div",Wt,[e("span",null,P(v.icon),1)])):C("",!0),n.current===v.value?(c(),g("svg",Yt,[...d[0]||(d[0]=[e("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z",fill:"currentColor"},null,-1)])])):C("",!0)],10,Jt))),128))])])):C("",!0)]),_:1})],64))}}),el=A(Xt,[["__scopeId","data-v-24c20201"]]),tl={key:0,class:"filter-tags-container"},ll={class:"tags-scroll"},il=["src","alt"],sl={class:"tag-label"},nl=["onClick","aria-label"],rl=I({__name:"ActiveFilterTags",props:{tags:{}},emits:["remove","clear-all"],setup(n,{emit:o}){const s=o,u=(m,d)=>{s("remove",m,d)},a=()=>{s("clear-all")};return(m,d)=>n.tags.length>0?(c(),g("div",tl,[e("div",ll,[e("button",{class:"clear-all-btn",onClick:a}," Clear All "),(c(!0),g(F,null,D(n.tags,v=>(c(),g("div",{key:`${v.key}-${v.label}`,class:"filter-tag"},[v.imageUrl?(c(),g("img",{key:0,src:v.imageUrl,alt:v.label,class:"tag-thumbnail"},null,8,il)):C("",!0),e("span",sl,P(v.label),1),e("button",{class:"tag-remove-btn",onClick:k=>u(v.key,v.label),"aria-label":`Remove ${v.label} filter`},[...d[0]||(d[0]=[e("svg",{viewBox:"0 0 24 24",width:"14",height:"14",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])],8,nl)]))),128))])])):C("",!0)}}),ol=A(rl,[["__scopeId","data-v-4ca4b413"]]),q="market_prices_cache",J=5*60*1e3;function se(n){return n.length===0?0:Math.min(...n.map(o=>o.price))}function al(n){if(n.length===0)return 0;const o=[...n].sort((u,a)=>u.price-a.price),s=Math.floor(o.length/2);return o.length%2!==0?o[s].price:(o[s-1].price+o[s].price)/2}function cl(n){return n.length===0?null:n.reduce((o,s)=>s.price<o.price?s:o)}class dl{cache={};constructor(){this.loadCache()}loadCache(){try{const o=localStorage.getItem(q);o&&(this.cache=JSON.parse(o),this.cleanExpiredCache())}catch(o){console.warn("Failed to load price cache:",o),this.cache={}}}persistCache(){try{localStorage.setItem(q,JSON.stringify(this.cache))}catch(o){console.warn("Failed to persist price cache:",o)}}cleanExpiredCache(){const o=Date.now();for(const[s,u]of Object.entries(this.cache))o-u.timestamp>J&&delete this.cache[s]}clearCache(){this.cache={},localStorage.removeItem(q)}getCachedPrice(o){const s=this.cache[o];return s?Date.now()-s.timestamp>J?(delete this.cache[o],0):se(s.prices):0}setCachedPrice(o,s){this.cache[o]={prices:s,timestamp:Date.now()}}async fetchFromApi(o){try{const s=await fetch(`/api/v1/gifts/${o}`);if(!s.ok)return null;const u=await s.json();return u.min_price_ton&&parseFloat(u.min_price_ton)>0?{source:"api",price:parseFloat(u.min_price_ton),currency:"TON",updatedAt:new Date}:null}catch{return null}}async getAggregatedPrice(o){const s=this.cache[o];if(s&&Date.now()-s.timestamp<J)return s.prices;const a=(await Promise.allSettled([this.fetchFromApi(o)])).filter(m=>m.status==="fulfilled").map(m=>m.value).filter(m=>m!==null&&m.price>0);return a.length>0&&this.setCachedPrice(o,a),a}async getAggregatedGifts(o){const s=new Map,u=10;for(let a=0;a<o.length;a+=u){const m=o.slice(a,a+u);await Promise.all(m.map(async d=>{const v=await this.getAggregatedPrice(d);v.length>0&&s.set(d,{giftId:d,name:"",model:"",prices:v,minPrice:se(v),medianPrice:al(v),bestDeal:cl(v)})}))}return s}}const Q=new dl;function ul(){const n=w(!1),o=w(null),s=w(new Map);return W(()=>{Q.loadCache()}),{isLoading:n,error:o,aggregatedData:s,preloadPrices:async a=>{n.value=!0,o.value=null;try{s.value=await Q.getAggregatedGifts(a),Q.persistCache()}catch(m){o.value="Failed to load prices",console.error("Preload prices error:",m)}finally{n.value=!1}}}}const ml={class:"market-view"},vl={class:"tabs"},gl=["onClick"],pl={class:"search-row"},fl={class:"search-box"},hl={class:"filters"},bl=["onClick"],yl={class:"controls-row"},kl={class:"controls-row__left"},_l={class:"cart-bar__counter"},wl=["disabled"],Cl={class:"cart-bar__count"},Pl={class:"controls-row__right"},xl={class:"grid-wrap"},$l={key:0,class:"grid"},Ml={key:1,class:"grid"},Bl={key:2,class:"pagination"},Ll=["disabled"],Sl={class:"pagination__info"},Gl=["disabled"],Il={key:3,class:"empty"},Al={class:"cart-bar"},Fl=["disabled"],Z=50,Dl=I({__name:"MarketView",setup(n){const o=He(),{hapticImpact:s}=re(),{preloadPrices:u,aggregatedData:a}=ul(),m=[{id:"all",label:"Gifts"},{id:"upgrades",label:"Upgrades"}],d=w("all"),v=w(!0),k=w([]),h=w(""),$=w("price asc"),x=w(!1),f=w(null),b=w(!1),_=w([]),L=w(1),O=w(50),i=Ue({names:[],models:[],backdrops:[],patterns:[],symbols:[],rarities:[],minPrice:null,maxPrice:null,giftId:null}),S=w([]),X=B(()=>{const r=new Map;return S.value.forEach(t=>{if(!t.name)return;const l=r.get(t.name),p=Number(t.lowest_price_ton||t.min_price_ton||t.price||0);l?(l.count++,p>0&&(l.minPrice===0||p<l.minPrice)&&(l.minPrice=p),!l.imageUrl&&t.image_url&&(l.imageUrl=t.image_url)):r.set(t.name,{count:1,minPrice:p,imageUrl:t.image_url})}),Array.from(r.entries()).map(([t,l])=>({value:t,label:t,count:l.count,floorPrice:l.minPrice>0?l.minPrice:void 0,imageUrl:l.imageUrl})).sort((t,l)=>(l.floorPrice||0)-(t.floorPrice||0))}),oe=B(()=>{const r=new Map;return S.value.forEach(t=>{if(!t.model)return;const l=r.get(t.model),p=Number(t.lowest_price_ton||t.min_price_ton||t.price||0);l?(l.count++,p>0&&(l.minPrice===0||p<l.minPrice)&&(l.minPrice=p)):r.set(t.model,{count:1,minPrice:p,total:S.value.length})}),Array.from(r.entries()).map(([t,l])=>({value:t,label:t,count:l.count,floorPrice:l.minPrice>0?l.minPrice:void 0,rarity:S.value.length>0?(l.count/S.value.length*100).toFixed(1)+"%":void 0})).sort((t,l)=>(l.floorPrice||0)-(t.floorPrice||0))}),ae=B(()=>{const r=new Map;return S.value.forEach(t=>{if(!t.backdrop)return;const l=r.get(t.backdrop),p=Number(t.lowest_price_ton||t.min_price_ton||t.price||0);l?(l.count++,p>0&&(l.minPrice===0||p<l.minPrice)&&(l.minPrice=p)):r.set(t.backdrop,{count:1,minPrice:p})}),Array.from(r.entries()).map(([t,l])=>({value:t,label:t,count:l.count,floorPrice:l.minPrice>0?l.minPrice:void 0})).sort((t,l)=>(l.floorPrice||0)-(t.floorPrice||0))}),ce=B(()=>{const r=new Map;return S.value.forEach(t=>{if(!t.symbol)return;const l=r.get(t.symbol),p=Number(t.lowest_price_ton||t.min_price_ton||t.price||0);l?(l.count++,p>0&&(l.minPrice===0||p<l.minPrice)&&(l.minPrice=p)):r.set(t.symbol,{count:1,minPrice:p})}),Array.from(r.entries()).map(([t,l])=>({value:t,label:t,count:l.count,floorPrice:l.minPrice>0?l.minPrice:void 0})).sort((t,l)=>(l.floorPrice||0)-(t.floorPrice||0))}),de=[{key:"collections",label:"Collections",filterGroup:"names"},{key:"model",label:"Model",filterGroup:"models"},{key:"backdrop",label:"Background",filterGroup:"backdrops"},{key:"symbol",label:"Symbol",filterGroup:"symbols"},{key:"price",label:"Price",filterGroup:"price"},{key:"giftId",label:"Gift ID",filterGroup:"giftId"}],ue=r=>{switch(r){case"collections":return i.names.length>0;case"model":return i.models.length>0;case"backdrop":return i.backdrops.length>0;case"symbol":return i.symbols.length>0;case"price":return i.minPrice!==null||i.maxPrice!==null;case"giftId":return i.giftId!==null;default:return!1}},me=r=>{switch(r.key){case"collections":return i.names.length>0?`Collections (${i.names.length})`:"Collections";case"model":return i.models.length>0?`Model (${i.models.length})`:"Model";case"backdrop":return i.backdrops.length>0?`Background (${i.backdrops.length})`:"Background";case"symbol":return i.symbols.length>0?`Symbol (${i.symbols.length})`:"Symbol";case"price":if(i.minPrice!==null||i.maxPrice!==null){const t=i.minPrice??0,l=i.maxPrice??"...";return`${t} - ${l} TON`}return"Price";case"giftId":return i.giftId!==null?`#${i.giftId}`:"Gift ID";default:return r.label}},ve=B(()=>{const r=[];return i.names.forEach(t=>{const l=X.value.find(p=>p.value===t);r.push({key:"names",label:t,imageUrl:l?.imageUrl})}),i.models.forEach(t=>{r.push({key:"models",label:t})}),i.backdrops.forEach(t=>{r.push({key:"backdrops",label:t})}),i.symbols.forEach(t=>{r.push({key:"symbols",label:t})}),(i.minPrice!==null||i.maxPrice!==null)&&r.push({key:"price",label:`${i.minPrice??0} - ${i.maxPrice??"..."} TON`}),i.giftId!==null&&r.push({key:"giftId",label:`#${i.giftId}`}),r}),ge=(r,t)=>{switch(s("light"),r){case"names":i.names=i.names.filter(l=>l!==t);break;case"models":i.models=i.models.filter(l=>l!==t);break;case"backdrops":i.backdrops=i.backdrops.filter(l=>l!==t);break;case"symbols":i.symbols=i.symbols.filter(l=>l!==t);break;case"price":i.minPrice=null,i.maxPrice=null;break;case"giftId":i.giftId=null;break}G()},pe=()=>{s("medium"),i.names=[],i.models=[],i.backdrops=[],i.patterns=[],i.symbols=[],i.rarities=[],i.minPrice=null,i.maxPrice=null,i.giftId=null,G()},fe=r=>{s("light"),f.value=r},he=r=>{i.names=r,G()},be=r=>{i.models=r,G()},ye=r=>{i.backdrops=r,G()},ke=r=>{i.symbols=r,G()},_e=(r,t)=>{i.minPrice=r,i.maxPrice=t,G()},we=r=>{i.giftId=r,G()},G=()=>{L.value=1,E()},Ce=[{value:"price asc",label:"Price: Low to High"},{value:"price desc",label:"Price: High to Low"},{value:"id asc",label:"Gift ID: Ascending"},{value:"id desc",label:"Gift ID: Descending"},{value:"rarity asc",label:"Model Rarity: Low to High"},{value:"rarity desc",label:"Model Rarity: High to Low"},{value:"listed_at desc",label:"Newest First"}],Pe=r=>{s("light"),d.value=r,r==="upgrades"&&o.push("/upgrade")},xe=r=>{s("light"),$.value=r,E()},$e=()=>{L.value>1&&(L.value--,E())},Me=()=>{L.value<O.value&&(L.value++,E())},E=async()=>{v.value=!0;try{const r=(L.value-1)*Z,t=h.value?.trim();let l;if(t)l=await Re(t,{limit:Z,collection_id:void 0});else{const y={is_on_sale:!0,sort:$.value,limit:Z,offset:r};i.models.length===1&&(y.model=i.models[0]),i.backdrops.length===1&&(y.backdrop=i.backdrops[0]),i.patterns.length===1&&(y.pattern=i.patterns[0]),i.symbols.length===1&&(y.symbol=i.symbols[0]),i.minPrice!==null&&(y.min_price=i.minPrice),i.maxPrice!==null&&(y.max_price=i.maxPrice),l=await le(y)}let p=l.items||l||[];i.names.length>0&&(p=p.filter(y=>i.names.includes(y.name))),i.models.length>1&&(p=p.filter(y=>i.models.includes(y.model))),i.backdrops.length>1&&(p=p.filter(y=>i.backdrops.includes(y.backdrop))),i.symbols.length>1&&(p=p.filter(y=>i.symbols.includes(y.symbol))),i.giftId!==null&&(p=p.filter(y=>y.tg_id===i.giftId||y.id===i.giftId||y.index===i.giftId)),S.value.length===0&&p.length>0&&(S.value=p),l.total&&(O.value=Math.ceil(l.total/Z)),k.value=p;const ee=p.map(y=>y.id||y.gift_id).filter(Boolean);ee.length>0&&u(ee).then(()=>{k.value=p.map(y=>{const Fe=String(y.id||y.gift_id||""),z=a.value.get(Fe);return z&&z.minPrice>0?{...y,lowest_price_ton:z.minPrice,lowest_price_market:z.bestDeal?.source||y.lowest_price_market}:y})})}catch(r){console.error("Fetch gifts error:",r),k.value=[]}finally{v.value=!1}},Be=async()=>{try{const r=await le({is_on_sale:!0,limit:500}),t=r.items||r||[];t.length>0&&(S.value=t)}catch{}},Le=async()=>{try{await Ne()}catch{}},Se=r=>{s("light"),o.push(`/gift/${r.id}`)},Ge=r=>{s("medium")},Ie=r=>{s("light");const t=_.value.indexOf(r.id);t>-1?_.value.splice(t,1):_.value.push(r.id)},Ae=()=>{s("heavy")};return W(()=>{E(),Le(),Be()}),(r,t)=>(c(),g("div",ml,[e("nav",vl,[(c(),g(F,null,D(m,l=>e("button",{key:l.id,class:T(["tabs__item",{active:d.value===l.id}]),onClick:p=>Pe(l.id)},P(l.label),11,gl)),64))]),e("div",pl,[e("div",fl,[t[13]||(t[13]=e("svg",{class:"search-box__icon",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"11",cy:"11",r:"8"}),e("path",{d:"m21 21-4.35-4.35"})],-1)),V(e("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>h.value=l),type:"text",placeholder:"Enter a keyword to search",class:"search-box__input",onKeyup:t[1]||(t[1]=Oe(l=>G(),["enter"]))},null,544),[[R,h.value]])]),e("button",{class:"icon-btn",onClick:t[2]||(t[2]=l=>E())},[...t[14]||(t[14]=[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"}),e("path",{d:"M21 3v5h-5"})],-1)])])]),e("div",hl,[(c(),g(F,null,D(de,l=>e("button",{key:l.key,class:T(["filter-btn",{active:ue(l.key)}]),onClick:p=>fe(l.key)},[e("span",null,P(me(l)),1),t[15]||(t[15]=e("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3"},[e("path",{d:"m6 9 6 6 6-6"})],-1))],10,bl)),64))]),e("div",yl,[e("div",kl,[e("div",_l,[e("button",{class:"cart-bar__btn",disabled:_.value.length===0,onClick:t[3]||(t[3]=l=>_.value.pop())},[...t[16]||(t[16]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2.5"},[e("path",{d:"M5 12h14"})],-1)])],8,wl),e("span",Cl,P(_.value.length),1),e("button",{class:"cart-bar__btn",onClick:t[4]||(t[4]=l=>b.value=!b.value)},[...t[17]||(t[17]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2.5"},[e("path",{d:"M12 5v14"}),e("path",{d:"M5 12h14"})],-1)])])])]),e("div",Pl,[e("button",{class:"icon-btn icon-btn--sm",onClick:t[5]||(t[5]=l=>x.value=!x.value)},[...t[18]||(t[18]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 6h18"}),e("path",{d:"M7 12h10"}),e("path",{d:"M10 18h4"})],-1)])])])]),M(ol,{tags:ve.value,onRemove:ge,onClearAll:pe},null,8,["tags"]),e("div",xl,[v.value?(c(),g("div",$l,[(c(),g(F,null,D(8,l=>M(at,{key:"sk-"+l})),64))])):(c(),g("div",Ml,[(c(!0),g(F,null,D(k.value,l=>(c(),N(nt,{key:l.id,gift:l,selectable:b.value,"is-selected":_.value.includes(l.id),onClick:Se,onBuy:Ge,onSelect:Ie},null,8,["gift","selectable","is-selected"]))),128))])),!v.value&&O.value>1?(c(),g("div",Bl,[e("button",{class:"pagination__btn",disabled:L.value<=1,onClick:$e},[...t[19]||(t[19]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"m15 18-6-6 6-6"})],-1)])],8,Ll),e("span",Sl,P(L.value)+" / "+P(O.value),1),e("button",{class:"pagination__btn",disabled:L.value>=O.value,onClick:Me},[...t[20]||(t[20]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"m9 18 6-6-6-6"})],-1)])],8,Gl)])):C("",!0),!v.value&&k.value.length===0?(c(),g("div",Il,[...t[21]||(t[21]=[e("p",{class:"empty__title"},"No gifts found",-1),e("p",{class:"empty__hint"},"Try adjusting your filters",-1)])])):C("",!0)]),e("div",Al,[e("button",{class:"cart-bar__checkout",disabled:_.value.length===0,onClick:Ae},[t[22]||(t[22]=e("svg",{class:"cart-bar__ton",width:"14",height:"14",viewBox:"0 0 16 16",fill:"none"},[e("path",{d:"M12.7238 1.00488H3.27565C1.53846 1.00488 0.437395 2.87874 1.31137 4.39358L7.14243 14.5002C7.52294 15.1601 8.47652 15.1601 8.85703 14.5002L14.6893 4.39358C15.5621 2.88116 14.461 1.00488 12.725 1.00488H12.7238ZM7.13769 11.4694L5.86778 9.01168L2.80363 3.53153C2.60149 3.18078 2.85116 2.7313 3.27446 2.7313H7.1365V11.4705L7.13769 11.4694ZM13.1935 3.53035L10.1305 9.01287L8.86059 11.4694V2.73011H12.7226C13.1459 2.73011 13.3956 3.17959 13.1935 3.53035Z",fill:"currentColor"})],-1)),e("span",null,"Cart ("+P(_.value.length)+")",1)],8,Fl)]),M(el,{visible:x.value,options:Ce,current:$.value,"onUpdate:visible":t[6]||(t[6]=l=>x.value=l),onSelect:xe},null,8,["visible","current"]),M(j,{visible:f.value==="collections",title:"Collections",options:X.value,selected:i.names,"show-thumbnails":!0,"onUpdate:visible":t[7]||(t[7]=l=>f.value=l?"collections":null),onApply:he},null,8,["visible","options","selected"]),M(j,{visible:f.value==="model",title:"Model",options:oe.value,selected:i.models,"show-thumbnails":!0,"show-rarity":!0,"onUpdate:visible":t[8]||(t[8]=l=>f.value=l?"model":null),onApply:be},null,8,["visible","options","selected"]),M(j,{visible:f.value==="backdrop",title:"Background",options:ae.value,selected:i.backdrops,"show-thumbnails":!1,"onUpdate:visible":t[9]||(t[9]=l=>f.value=l?"backdrop":null),onApply:ye},null,8,["visible","options","selected"]),M(j,{visible:f.value==="symbol",title:"Symbol",options:ce.value,selected:i.symbols,"show-thumbnails":!0,"onUpdate:visible":t[10]||(t[10]=l=>f.value=l?"symbol":null),onApply:ke},null,8,["visible","options","selected"]),M(Ot,{visible:f.value==="price","min-price":i.minPrice,"max-price":i.maxPrice,"onUpdate:visible":t[11]||(t[11]=l=>f.value=l?"price":null),onApply:_e},null,8,["visible","min-price","max-price"]),M(Zt,{visible:f.value==="giftId","gift-id":i.giftId,"onUpdate:visible":t[12]||(t[12]=l=>f.value=l?"giftId":null),onApply:we},null,8,["visible","gift-id"])]))}}),Hl=A(Dl,[["__scopeId","data-v-bbb91caf"]]);export{Hl as default};
