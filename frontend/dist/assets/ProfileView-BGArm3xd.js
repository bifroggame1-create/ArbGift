import{d as $,j as z,c as n,b as t,t as a,a as g,k as J,G as v,F as _,f as B,g as M,w as T,h as F,A as S,I as p,z as A,B as E,l as y,r,e as Y,o as l,n as Q}from"./vue-Dr6T3rTv.js";import{u as q,a as K}from"./index-6vjp85YO.js";import{u as X}from"./useTonConnect-D7CcwWYL.js";import{d as tt}from"./client-pJ2CWAUX.js";const et={class:"mb-profile"},at={class:"mb-balance-section"},st={class:"mb-balance-row"},lt={class:"mb-balance-value"},ot={class:"mb-actions-row"},it={class:"mb-user-section"},nt={class:"mb-user-row"},rt={class:"mb-user-info"},dt={class:"mb-username"},ct={class:"mb-card mb-inventory-card"},vt={class:"mb-inventory-header"},mt={class:"mb-inventory-meta"},bt={class:"mb-inventory-count"},ut={class:"mb-inventory-value"},pt={width:"12",height:"12",viewBox:"0 0 56 56",fill:"none",style:{"vertical-align":"middle","margin-left":"2px"}},ht={class:"mb-inventory-grid"},ft={class:"mb-inventory-empty"},xt={class:"mb-card mb-claim-card"},wt={class:"mb-claim-header"},gt={class:"mb-claim-amounts"},yt={class:"mb-claim-value"},kt={class:"mb-claim-stats"},Ct={class:"mb-claim-stat"},Lt={class:"mb-claim-stat-value"},_t={class:"mb-claim-stat"},Bt={class:"mb-claim-stat-value"},Mt=["disabled"],Tt={class:"mb-modal-content"},Ft={class:"mb-modal-body"},St={key:0,class:"mb-connect-section"},At=["disabled"],Et={key:1,class:"mb-deposit-info"},Vt={class:"mb-wallet-info"},It={class:"mb-wallet-value"},Pt={class:"mb-modal-content"},Wt={class:"mb-modal-body"},jt={class:"mb-stars-grid"},Ht=["onClick"],Nt={class:"mb-pkg-amount"},Rt={class:"mb-pkg-price"},Ut=["disabled"],Zt="linear-gradient(135deg, #3b82f6, #8b5cf6)",V="UQBxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",Dt=$({__name:"ProfileView",setup(Gt){const{user:d,initWebApp:I}=q(),c=X(),k=y(()=>d.value?.username||d.value?.first_name||"Player"),P=y(()=>k.value.charAt(0).toUpperCase()),W=r(0),j=r(0),h=r({totalGifts:0,gamesPlayed:0,wins:0,totalWon:0}),m=r({count:0,earned:0}),C=y(()=>`t.me/giftbot?start=ref${d.value?.id||""}`),f=r(!1),x=r(!1),o=r(null),b=r(!1),H=[{amount:50,priceRub:90},{amount:100,priceRub:180},{amount:250,priceRub:450},{amount:500,priceRub:900}],N=()=>{f.value=!0},L=()=>{f.value=!1},R=()=>{x.value=!0,o.value=null},w=()=>{x.value=!1,o.value=null},U=async()=>{try{await c.connect()}catch(s){console.error("Wallet connection failed:",s)}},Z=()=>{navigator.clipboard.writeText(V)},D=async()=>{if(o.value){b.value=!0;try{const s=await fetch("/api/v1/stars/invoice",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:d.value?.id,amount:o.value})});if(!s.ok)throw new Error("Failed to create invoice");const e=await s.json();window.Telegram?.WebApp?.openInvoice?window.Telegram.WebApp.openInvoice(e.invoice_url,u=>{u==="paid"&&(j.value+=o.value,w())}):window.open(e.invoice_url,"_blank")}catch(s){console.error("Stars purchase failed:",s)}finally{b.value=!1}}},G=()=>{navigator.clipboard.writeText(C.value)},O=()=>{const e=`https://t.me/share/url?url=${encodeURIComponent(C.value)}&text=${encodeURIComponent("Join me and play! Use my referral link:")}`;window.Telegram?.WebApp?.openTelegramLink?window.Telegram.WebApp.openTelegramLink(e):window.open(e,"_blank")};return z(async()=>{if(I(),await c.init("giftmarket_bot"),d.value?.id)try{const s=await tt(d.value.id);h.value.totalWon=parseFloat(s.total_rewards_earned_ton||"0")}catch{}}),(s,e)=>{const u=Y("router-link");return l(),n("div",et,[e[31]||(e[31]=t("div",{class:"mb-gradient-header"},null,-1)),t("div",at,[e[2]||(e[2]=t("span",{class:"mb-balance-label"},"Play Balance",-1)),t("div",st,[t("span",lt,a(W.value.toFixed(2)),1),e[1]||(e[1]=t("svg",{class:"mb-ton-icon",width:"28",height:"28",viewBox:"0 0 56 56",fill:"none"},[t("circle",{cx:"28",cy:"28",r:"28",fill:"#0098EA"}),t("path",{d:"M37.5603 15.6277H18.4386C14.9228 15.6277 12.6944 19.4202 14.4632 22.4861L26.2644 42.9409C27.0345 44.2765 28.9644 44.2765 29.7345 42.9409L41.5765 22.4861C43.3045 19.4202 41.0761 15.6277 37.5603 15.6277Z",fill:"white"})],-1))])]),t("div",ot,[t("button",{class:"mb-action-item",onClick:R},[...e[3]||(e[3]=[t("div",{class:"mb-action-circle"},[t("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none"},[t("path",{d:"M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z",fill:"#FFCE4F",stroke:"#FFCE4F","stroke-width":"1"})])],-1),t("span",{class:"mb-action-label"},"Top Up Stars",-1)])]),t("button",{class:"mb-action-item",onClick:N},[...e[4]||(e[4]=[g('<div class="mb-action-circle" data-v-42e0a101><svg width="24" height="24" viewBox="0 0 56 56" fill="none" data-v-42e0a101><circle cx="28" cy="28" r="28" fill="#0098EA" data-v-42e0a101></circle><path d="M37.5603 15.6277H18.4386C14.9228 15.6277 12.6944 19.4202 14.4632 22.4861L26.2644 42.9409C27.0345 44.2765 28.9644 44.2765 29.7345 42.9409L41.5765 22.4861C43.3045 19.4202 41.0761 15.6277 37.5603 15.6277Z" fill="white" data-v-42e0a101></path></svg></div><span class="mb-action-label" data-v-42e0a101>Top Up TON</span>',2)])]),t("button",{class:"mb-action-item",onClick:e[0]||(e[0]=i=>s.$router.push("/inventory"))},[...e[5]||(e[5]=[g('<div class="mb-action-circle" data-v-42e0a101><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="rgba(255,255,255,0.7)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-v-42e0a101><rect x="3" y="8" width="18" height="13" rx="2" data-v-42e0a101></rect><path d="M16 8V6a4 4 0 0 0-8 0v2" data-v-42e0a101></path><path d="M12 14v2" data-v-42e0a101></path><circle cx="12" cy="14" r="1" data-v-42e0a101></circle></svg></div><span class="mb-action-label" data-v-42e0a101>Deposit Gifts</span>',2)])])]),t("div",it,[t("div",nt,[t("div",{class:"mb-user-avatar",style:J({background:Zt})},[t("span",null,a(P.value),1)],4),t("div",rt,[t("span",dt,"@"+a(k.value),1)]),e[6]||(e[6]=t("button",{class:"mb-settings-btn"},[t("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"rgba(255,255,255,0.5)","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("circle",{cx:"12",cy:"12",r:"3"}),t("path",{d:"M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"})])],-1))])]),t("div",ct,[t("div",vt,[e[8]||(e[8]=t("span",{class:"mb-inventory-title"},"My Inventory",-1)),t("div",mt,[t("span",bt,a(h.value.totalGifts)+" Items",1),t("span",ut,[v(a(h.value.totalWon.toFixed(1))+" ",1),(l(),n("svg",pt,[...e[7]||(e[7]=[t("circle",{cx:"28",cy:"28",r:"28",fill:"#0098EA"},null,-1),t("path",{d:"M37.5603 15.6277H18.4386C14.9228 15.6277 12.6944 19.4202 14.4632 22.4861L26.2644 42.9409C27.0345 44.2765 28.9644 44.2765 29.7345 42.9409L41.5765 22.4861C43.3045 19.4202 41.0761 15.6277 37.5603 15.6277Z",fill:"white"},null,-1)])]))])])]),t("div",ht,[(l(),n(_,null,B(3,i=>t("div",{class:"mb-inventory-placeholder",key:i},[...e[9]||(e[9]=[t("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",stroke:"rgba(255,255,255,0.15)","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},[t("rect",{x:"3",y:"8",width:"18",height:"13",rx:"2"}),t("path",{d:"M16 8V6a4 4 0 0 0-8 0v2"})],-1)])])),64))]),M(u,{to:"/inventory",class:"mb-inventory-link"},{default:T(()=>[...e[10]||(e[10]=[t("span",null,"All Items",-1),t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M9 18l6-6-6-6"})],-1)])]),_:1}),t("div",ft,[e[12]||(e[12]=t("span",{class:"mb-empty-text"},"You have no items yet.",-1)),M(u,{to:"/inventory",class:"mb-deposit-link"},{default:T(()=>[...e[11]||(e[11]=[v(" Deposit Gift ",-1),t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M9 18l6-6-6-6"})],-1)])]),_:1})])]),t("div",{class:"mb-card mb-referral-card"},[e[14]||(e[14]=g('<div class="mb-referral-content" data-v-42e0a101><div class="mb-referral-text-block" data-v-42e0a101><p class="mb-referral-description" data-v-42e0a101> Invite referrals to earn <span class="mb-referral-badge" data-v-42e0a101>10%</span> of their game fees </p></div><div class="mb-referral-illustration" data-v-42e0a101><svg width="72" height="72" viewBox="0 0 80 80" fill="none" data-v-42e0a101><circle cx="40" cy="32" r="16" fill="#22C55E" opacity="0.3" data-v-42e0a101></circle><circle cx="40" cy="32" r="10" fill="#22C55E" opacity="0.6" data-v-42e0a101></circle><circle cx="40" cy="28" r="8" fill="#22C55E" data-v-42e0a101></circle><rect x="32" y="40" width="16" height="20" rx="4" fill="#22C55E" opacity="0.8" data-v-42e0a101></rect><circle cx="60" cy="28" r="6" fill="#4ADE80" opacity="0.5" data-v-42e0a101></circle><rect x="57" y="22" width="6" height="1.5" rx="0.75" fill="#fff" opacity="0.8" data-v-42e0a101></rect><rect x="59.25" y="19.75" width="1.5" height="6" rx="0.75" fill="#fff" opacity="0.8" data-v-42e0a101></rect></svg></div></div>',1)),t("div",{class:"mb-referral-actions"},[t("button",{class:"mb-btn-invite",onClick:O}," Invite Friends "),t("button",{class:"mb-btn-copy",onClick:G},[...e[13]||(e[13]=[t("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),t("path",{d:"M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"})],-1)])])])]),t("div",xt,[t("div",wt,[e[16]||(e[16]=t("svg",{class:"mb-claim-ton-icon",width:"32",height:"32",viewBox:"0 0 56 56",fill:"none"},[t("circle",{cx:"28",cy:"28",r:"28",fill:"#0098EA"}),t("path",{d:"M37.5603 15.6277H18.4386C14.9228 15.6277 12.6944 19.4202 14.4632 22.4861L26.2644 42.9409C27.0345 44.2765 28.9644 44.2765 29.7345 42.9409L41.5765 22.4861C43.3045 19.4202 41.0761 15.6277 37.5603 15.6277Z",fill:"white"})],-1)),t("div",gt,[t("span",yt,a(m.value.earned.toFixed(2))+" TON",1),e[15]||(e[15]=t("span",{class:"mb-claim-label"},"Claimable amount",-1))])]),t("div",kt,[t("div",Ct,[t("span",Lt,a(m.value.count),1),e[17]||(e[17]=t("span",{class:"mb-claim-stat-label"},"Invited users",-1))]),t("div",_t,[t("span",Bt,a(m.value.earned.toFixed(2)),1),e[18]||(e[18]=t("span",{class:"mb-claim-stat-label"},"Total claimed amount",-1))])]),t("button",{class:"mb-btn-claim",disabled:m.value.earned<=0}," Claim ",8,Mt)]),e[32]||(e[32]=t("div",{class:"mb-bottom-spacer"},null,-1)),(l(),F(E,{to:"body"},[f.value?(l(),n("div",{key:0,class:"mb-modal-overlay",onClick:S(L,["self"])},[t("div",Tt,[t("div",{class:"mb-modal-header"},[e[20]||(e[20]=t("h3",{class:"mb-modal-title"},[t("svg",{width:"18",height:"18",viewBox:"0 0 56 56",fill:"none"},[t("circle",{cx:"28",cy:"28",r:"28",fill:"#0098EA"}),t("path",{d:"M37.5603 15.6277H18.4386C14.9228 15.6277 12.6944 19.4202 14.4632 22.4861L26.2644 42.9409C27.0345 44.2765 28.9644 44.2765 29.7345 42.9409L41.5765 22.4861C43.3045 19.4202 41.0761 15.6277 37.5603 15.6277Z",fill:"white"})]),v(" Top Up TON ")],-1)),t("button",{class:"mb-modal-close",onClick:L},[...e[19]||(e[19]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2.5"},[t("path",{d:"M18 6L6 18M6 6l12 12"})],-1)])])]),t("div",Ft,[p(c).isConnected.value?(l(),n("div",Et,[e[24]||(e[24]=t("p",{class:"mb-modal-text"},"Send TON to the project address:",-1)),t("div",{class:"mb-address-box"},[t("span",{class:"mb-address"},a(V)),t("button",{class:"mb-btn-copy-sm",onClick:Z},[...e[22]||(e[22]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2"}),t("path",{d:"M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"})],-1)])])]),e[25]||(e[25]=t("p",{class:"mb-modal-hint"},"Balance will update automatically after transfer",-1)),t("div",Vt,[e[23]||(e[23]=t("span",{class:"mb-wallet-label"},"Your wallet:",-1)),t("span",It,a(p(c).shortAddress.value),1)])])):(l(),n("div",St,[e[21]||(e[21]=t("p",{class:"mb-modal-text"},"Connect wallet to see deposit address",-1)),t("button",{class:"mb-btn-connect",onClick:U,disabled:p(c).isConnecting.value},a(p(c).isConnecting.value?"Connecting...":"Connect Wallet"),9,At)]))])])])):A("",!0)])),(l(),F(E,{to:"body"},[x.value?(l(),n("div",{key:0,class:"mb-modal-overlay",onClick:S(w,["self"])},[t("div",Pt,[t("div",{class:"mb-modal-header"},[e[27]||(e[27]=t("h3",{class:"mb-modal-title"},[t("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none"},[t("path",{d:"M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z",fill:"#FFCE4F"})]),v(" Buy Stars ")],-1)),t("button",{class:"mb-modal-close",onClick:w},[...e[26]||(e[26]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2.5"},[t("path",{d:"M18 6L6 18M6 6l12 12"})],-1)])])]),t("div",Wt,[e[29]||(e[29]=t("p",{class:"mb-modal-text"},"Select Stars package",-1)),t("div",jt,[(l(),n(_,null,B(H,i=>t("button",{key:i.amount,class:Q(["mb-stars-pkg",{selected:o.value===i.amount}]),onClick:Ot=>o.value=i.amount},[t("span",Nt,[e[28]||(e[28]=t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none"},[t("path",{d:"M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z",fill:"#FFCE4F"})],-1)),v(" "+a(i.amount),1)]),t("span",Rt,a(i.priceRub)+" RUB",1)],10,Ht)),64))]),t("button",{class:"mb-btn-buy",onClick:D,disabled:!o.value||b.value},a(b.value?"Processing...":"Buy Stars"),9,Ut),e[30]||(e[30]=t("p",{class:"mb-modal-hint"},"Payment via Telegram Stars",-1))])])])):A("",!0)]))])}}}),Qt=K(Dt,[["__scopeId","data-v-42e0a101"]]);export{Qt as default};
